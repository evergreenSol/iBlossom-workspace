<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="reviewMapper">

 <resultMap id="reviewResultSet" type="review">
      <result column="REVIEW_NO" property="reviewNo" />
      <result column="REVIEW_TITLE" property="reviewTitle" />
      <result column="REVIEW_CONTENT" property="reviewContent" />
      <result column="REVIEW_PHOTO" property="reviewPhoto" />
      <result column="CREATE_DATE" property="createDate" />
      <result column="REVIEW_STATUS" property="reviewStatus" />
      <result column="ORDER_NO" property="orderNo" />
      <result column="USER_NO" property="userNo" />
      <result column="PRODUCT_NO" property="productNo" />
      <result column="USER_ID" property="userId"/>
      <result column="FLOWER_NAME" property="flowerName"/>
   </resultMap>
   
   <!-- 게시글 총 개수 -->
   	<select id="selectListCount" resultType="_int">
      SELECT COUNT(*)
   		FROM
   		FLOWER_REVIEW
   		WHERE REVIEW_STATUS = 'Y'
   	</select> 
   
    <!-- 리뷰 전체보기(admin) -->
     <select id="selectReviewList" resultMap="reviewResultSet">
      SELECT REVIEW_NO, REVIEW_TITLE, REVIEW_CONTENT, REVIEW_PHOTO, CREATE_DATE, REVIEW_STATUS, USER_ID, FLOWER_NAME
      FROM FLOWER_REVIEW F INNER JOIN MEMBER M
      ON F.USER_NO = M.USER_NO
        INNER JOIN PRODUCT P
      ON F.PRODUCT_NO = P.PRODUCT_NO
       WHERE REVIEW_STATUS='Y'
     </select>

	<!-- 리뷰 작성하기 -->
   <insert id="insertReview" parameterType="review">
        INSERT INTO FLOWER_REVIEW(REVIEW_NO
                         , REVIEW_TITLE
                         , REVIEW_CONTENT
                         , REVIEW_PHOTO
                         , ORDER_NO
                         , USER_NO
                         , PRODUCT_NO)
      VALUES(SEQ_RNO.NEXTVAL
           , #{reviewTitle}
           , 'path'
           , #{reviewPhoto}
           , #{orderNo}
           , #{userNo}
           , #{productNo})
     </insert>
     
 
     
     <!-- 리뷰 삭제하기 -->
     <update id="deleteReview" parameterType="_int">
     	UPDATE FLOWER_REVIEW
     	SET REVIEW_STATUS = 'N'
     	WHERE REVIEW_NO = #{reviewNo}
     </update> 
     
     <!-- 리뷰 수정하기 -->
     	<update id="updateReview" parameterType="product">
		UPDATE PRODUCT
		SET REVIEW_TITLE = #{reviewTitle}
			, REVIEW_CONTENT = #{flowerName}
			, REVIEW_PHOTO = 'path'
		WHERE REVIEW_NO = #{reviewNo}
	</update>

</mapper>
